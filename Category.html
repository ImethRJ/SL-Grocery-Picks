<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Category Page</title>
    <link rel="stylesheet" href="./CSS/Category.css">
  </head>
  <body>
    <nav class="navbar">
      <ul class="nav-links">
        <li><a href="index.html">Home</a></li>
        <li><a href="Category.html">Category</a></li>
        <li><a href="Contact.html">Contact</a></li>
        <li><a href="Signup.html">Signup</a></li>
      </ul>
    </nav>

    <div class="main-content">
      <aside class="sidebar">
        <h3>Categories</h3>
        <ul class="category-list">
          <li><a href="#Vegetables">Vegetables</a></li>
          <li><a href="#Fruits">Fruits</a></li>
          <li><a href="#Beverages">Beverages</a></li>
          <li><a href="#home-appliances">Home Appliances</a></li>
          <li><a href="#Dry Foods">Dry Foods</a></li>
          <li><a href="#Personal Care">Personal Care</a></li>
        </ul>
      </aside>

      <section class="products-display">
        <h2 id="Vegetables">Vegetables</h2>
        <div class="products-grid">
          <div class="product-card">
            <img src="./Images/Product1.png" alt="Product 1" />
            <h4>Carrot</h4>
            <p>Rs. 200 - 100g</p>
            <button class="add-to-cart">Add to Cart</button>
          </div>
          <div class="product-card">
            <img src="./Images/Product2.jpeg" alt="Product 2" />
            <h4>Brocloli</h4>
            <p>Rs. 100 - 100g</p>
            <button class="add-to-cart">Add to Cart</button>
          </div>
          <div class="product-card">
            <img src="./Images/Product3.jpeg" alt="Product 3" />
            <h4>Beetroot</h4>
            <p>Rs. 220 - 100g</p>
            <button class="add-to-cart">Add to Cart</button>
          </div>
          <div class="product-card">
            <img src="./Images/Product4.jpeg" alt="Product 4" />
            <h4>Tomato</h4>
            <p>Rs. 60 - 100g</p>
            <button class="add-to-cart">Add to Cart</button>
          </div>
        </div>

        <h2 id="Fruits">Fruits</h2>
        <div class="products-grid">
          <div class="product-card">
            <img src="./Images/Product6.jpeg" alt="Product 5" />
            <h4>Mango</h4>
            <p>Rs. 100 - 100g</p>
            <button class="add-to-cart">Add to Cart</button>
          </div>
          <div class="product-card">
            <img src="./Images/Product7.jpg" alt="Product 6" />
            <h4>Strawberry</h4>
            <p>Rs. 220 - 100g</p>
            <button class="add-to-cart">Add to Cart</button>
          </div>
          <div class="product-card">
            <img src="./Images/Product8.jpeg" alt="Product 7" />
            <h4>Banana</h4>
            <p>Rs. 220 - 100g</p>
            <button class="add-to-cart">Add to Cart</button>
          </div>
          <div class="product-card">
            <img src="./Images/Product9.jpeg" alt="Product 8" />
            <h4>Woodapple</h4>
            <p>Rs. 100 - 100g</p>
            <button class="add-to-cart">Add to Cart</button>
          </div>
        </div>

        <h2 id="Beverages">Beverages</h2>
        <div class="products-grid">
          <div class="product-card">
            <img src="./Images/Product10.jpeg" alt="Product 9" />
            <h4>Fanta</h4>
            <p>Rs. 170</p>
            <button class="add-to-cart">Add to Cart</button>
          </div>
          <div class="product-card">
            <img src="./Images/Product11.jpeg" alt="Product 10" />
            <h4>Cocacola</h4>
            <p>Rs. 170</p>
            <button class="add-to-cart">Add to Cart</button>
          </div>
          <div class="product-card">
            <img src="./Images/Product12.jpeg" alt="Product 11" />
            <h4>Iced Coffee</h4>
            <p>Rs. 500</p>
            <button class="add-to-cart">Add to Cart</button>
          </div>
          <div class="product-card">
            <img src="./Images/Product13.jpeg" alt="Product 12 " />
            <h4>Necto</h4>
            <p>Rs. 300</p>
            <button class="add-to-cart">Add to Cart</button>
          </div>
        </div>

        <h2 id="home-appliances">Home Appliances</h2>
        <div class="products-grid">
          <div class="product-card">
            <img src="./Images/Product14.jpeg" alt="Product 13" />
            <h4>Nonstick Pan</h4>
            <p>Rs. 2000</p>
            <button class="add-to-cart">Add to Cart</button>
          </div>
          <div class="product-card">
            <img src="./Images/Product15.jpeg" alt="Product 14" />
            <h4>Washing Machine</h4>
            <p>Rs. 200000</p>
            <button class="add-to-cart">Add to Cart</button>
          </div>
          <div class="product-card">
            <img src="./Images/Product16.jpeg" alt="Product 15" />
            <h4>Rice Cooker</h4>
            <p>Rs. 7000</p>
            <button class="add-to-cart">Add to Cart</button>
          </div>
          <div class="product-card">
            <img src="./Images/Product17.jpeg" alt="Product 16 " />
            <h4>Blender</h4>
            <p>Rs. 20000</p>
            <button class="add-to-cart">Add to Cart</button>
          </div>
        </div>
        <h2 id="Dry Foods">Dry Foods</h2>
        <div class="products-grid">
          <div class="product-card">
            <img src="./Images/Product18.jpeg" alt="Product 17" />
            <h4>Peanuts</h4>
            <p>Rs. 1000</p>
            <button class="add-to-cart">Add to Cart</button>
          </div>
          <div class="product-card">
            <img src="./Images/Product19.jpeg" alt="Product 18" />
            <h4>Powdered Milk</h4>
            <p>Rs. 1080</p>
            <button class="add-to-cart">Add to Cart</button>
          </div>
          <div class="product-card">
            <img src="./Images/Product20.jpeg" alt="Product 19" />
            <h4>Pasta</h4>
            <p>Rs. 400</p>
            <button class="add-to-cart">Add to Cart</button>
          </div>
          <div class="product-card">
            <img src="./Images/Product22.jpeg" alt="Product 20 " />
            <h4>Rice</h4>
            <p>Rs. 1000</p>
            <button class="add-to-cart">Add to Cart</button>
          </div>
        </div>

        <h2 id="Personal Care">Personal Care</h2>
        <div class="products-grid">
          <div class="product-card">
            <img src="./Images/Product21.jpeg" alt="Product 21" />
            <h4>Product 1</h4>
            <p>Rs. 299</p>
            <button class="add-to-cart">Add to Cart</button>
          </div>
          <div class="product-card">
            <img src="./Images/Product23.jpeg" alt="Product 22" />
            <h4>Shampoo</h4>
            <p>Rs. 420</p>
            <button class="add-to-cart">Add to Cart</button>
          </div>
          <div class="product-card">
            <img src="./Images/Product24.jpeg" alt="Product 23" />
            <h4>conditioner shampoo</h4>
            <p>Rs. 1275</p>
            <button class="add-to-cart">Add to Cart</button>
          </div>
          <div class="product-card">
            <img src="./Images/Product25.png" alt="Product 24 " />
            <h4>Toothpaste</h4>
            <p>Rs. 120</p>
            <button class="add-to-cart">Add to Cart</button>
          </div>
        </div>
      </section>

      <aside class="cart-summary">
        <h3>Cart Summary</h3>
        <div class="cart-items"></div>
        <p>Total: RS.0.00</p>
        <button class="checkout-btn">Checkout</button>
      </aside>
    </div>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const cartItemsContainer = document.querySelector(".cart-items");
        const totalElement = document.querySelector(".cart-summary p");
        const checkoutButton = document.querySelector(".checkout-btn");

        let total = 0; // Correctly track the total in this scope
        const cart = {};

        function parsePrice(priceText) {
          const cleanedPrice = priceText.match(/[\d,]+(\.\d+)?/g); // This ensures Rs..1275 and Rs.120 are correctly handled
          if (cleanedPrice) {
            return parseFloat(cleanedPrice[0].replace(",", "")); // Handles cases where prices may include commas (e.g., 1,275)
          }
          return 0;
        }

        function addToCart(product, price) {
          if (cart[product]) {
            cart[product].quantity++;
          } else {
            cart[product] = { price, quantity: 1 };
          }
          renderCart();
        }

        function updateQuantity(product, increment) {
          if (cart[product]) {
            cart[product].quantity += increment;
            if (cart[product].quantity <= 0) delete cart[product];
          }
          renderCart();
        }

        function removeFromCart(product) {
          delete cart[product];
          renderCart();
        }

        function renderCart() {
          cartItemsContainer.innerHTML = "";
          total = 0; // Reset total before recalculating

          for (const product in cart) {
            const { price, quantity } = cart[product];
            total += price * quantity;

            const cartItem = document.createElement("div");
            cartItem.className = "cart-item";

            cartItem.innerHTML = `
              <span>${product} - Rs. ${price} x ${quantity}</span>
              <div class="quantity-controls">
                <button class="decrease" data-product="${product}">-</button>
                <span>${quantity}</span>
                <button class="increase" data-product="${product}">+</button>
              </div>
              <button class="remove" data-product="${product}">Remove</button>
            `;
            cartItemsContainer.appendChild(cartItem);
          }

          // Update total display dynamically
          totalElement.textContent = `Total: Rs. ${total.toFixed(2)}`;
        }

        document.querySelectorAll(".add-to-cart").forEach((button) => {
          button.addEventListener("click", (event) => {
            const productCard = event.target.closest(".product-card");
            const productName = productCard.querySelector("h4").textContent;
            const productPriceText = productCard.querySelector("p").textContent;
            const productPrice = parsePrice(productPriceText);

            addToCart(productName, productPrice);
          });
        });

        cartItemsContainer.addEventListener("click", (event) => {
          const target = event.target;
          const product = target.dataset.product;

          if (target.classList.contains("increase")) {
            updateQuantity(product, 1);
          } else if (target.classList.contains("decrease")) {
            updateQuantity(product, -1);
          } else if (target.classList.contains("remove")) {
            removeFromCart(product);
          }
        });

        // Corrected Checkout button event listener
        checkoutButton.addEventListener("click", () => {
          if (Object.keys(cart).length === 0) {
            alert("Your cart is empty. Please add items before checking out.");
          } else {
            // Use the dynamically computed total
            alert(
              `Thank you for your purchase! Your total is Rs. ${total.toFixed(
                2
              )}`
            );
          }
        });
      });
    </script>
  </body>
</html>
